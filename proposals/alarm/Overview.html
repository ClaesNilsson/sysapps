<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html lang="en"><head>

<meta content="text/html; charset=utf-8" http-equiv="content-type">
<title>Web Alarms API Specification</title>
<style type="text/css">
   pre.idl { border:solid thin; background:#eee; color:#000; padding:0.5em }
   pre.idl :link, pre.idl :visited { color:inherit; background:transparent }
   pre code { color:inherit; background:transparent }
   div.example { margin-left:1em; padding-left:1em; border-left:double; color:#222; background:#fcfcfc }
   .note { margin-left:2em; font-weight:bold; font-style:italic; color:#008000 }
   p.note::before { content:"Note: " }
   .XXX { padding:.5em; border:solid #f00 }
   p.XXX::before { content:"Issue: " }
   dl.switch { padding-left:2em }
   dl.switch > dt { text-indent:-1.5em }
   dl.switch > dt:before { content:'\21AA'; padding:0 0.5em 0 0; display:inline-block; width:1em; text-align:right; line-height:0.5em }
   dl.domintro { color: green; margin: 2em 0 2em 2em; padding: 0.5em 1em; border: none; background: #DDFFDD; }
   dl.domintro dt, dl.domintro dt * { color: black; text-decoration: none; }
   dl.domintro dd { margin: 0.5em 0 1em 2em; padding: 0; }
   dl.domintro dd p { margin: 0.5em 0; }
   dl.domintro:before { display: table; margin: -1em -0.5em -0.5em auto; width: auto; content: 'This box is non-normative. Implementation requirements are given below this box.'; color: red; border: solid 2px; background: white; padding: 0 0.25em; }
   em.ct { text-transform:lowercase; font-variant:small-caps; font-style:normal }
   dfn { font-weight:bold; font-style:normal }
   code { color:orangered }
   code :link, code :visited { color:inherit }
   hr:not(.top) { display:block; background:none; border:none; padding:0; margin:2em 0; height:auto }
   table { border-collapse:collapse; border-style:hidden hidden none hidden }
   table thead { border-bottom:solid }
   table tbody th:first-child { border-left:solid }
   table td, table th { border-left:solid; border-right:solid; border-bottom:solid thin; vertical-align:top; padding:0.2em }
</style>
<link href="http://www.w3.org/StyleSheets/TR/W3C-ED" rel="stylesheet">

<body class="draft">

<div class="head">
	<h1>Web Alarms API Specification</h1>
	
	<h2 class="no-num no-toc" id="editor-draft-26-october-2012">Editor Draft &mdash; 26 October 2012</h2>
	
	<dl>
		<dt>This version:
		<dd><!--begin-link--><a href="http://example.com/">http://example.com/</a><!--end-link-->

		<dt class="dontpublish">Participate:</dt>
		<dd class="dontpublish"><a href="mailto:public-sysapps@w3.org?subject=[alarm-api]%20">public-sysapps@w3.org</a> (<a href="http://lists.w3.org/Archives/Public/public-sysapps/">archives</a>)
		<dd class="dontpublish"><a href="https://www.w3.org/Bugs/Public/enter_bug.cgi?product=SysAppsWG&amp;component=Alarms%20API">File a bug</a>
		
		<dt>Latest version:
		<dd><!--begin-link--><a href="http://example.com/">http://example.com/</a><!--end-link-->
		
		<dt>Previous versions:
		<dd><!--begin-link--><a href="http://example.com/">http://example.com/</a><!--end-link-->
		
		<dt>Editors:
		<dd class="vcard">
			<span class="fn">Jonas Sicking</span>,
			<span class="org"><a href="http://www.mozilla.org">Mozilla Corporation</a></span>,
			<span class="email"><a href="mailto:jonas@sicking.cc">jonas@sicking.cc</a></span>
		<dd class="vcard">
			<span class="fn">Christophe Dumez</span>,
			<span class="org"><a href="http://www.intel.com">Intel Corporation</a></span>,
			<span class="email"><a href="mailto:christophe.dumez@intel.com">christophe.dumez@intel.com</a></span>
	</dl>
	
        <div class="w3conly">
<!--begin-copyright-->
<p class="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> &copy; 2012 <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>&reg;</sup> (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="http://www.keio.ac.jp/">Keio</a>), All Rights Reserved. W3C <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply.</p>
<!--end-copyright--></div>
</div>

<h2 class="no-num no-toc" id="specabstract">Abstract</h2>

<p>This specification defines a System Level API to provide access to the device alarm settings, which can schedule a notification or for an application to be started at a specific time. For example, some applications like alarm-clock, calendar or auto-update might need to utilize Alarm API to trigger particular device behaviors at specified time points. 

<h2 class="no-num no-toc" id="toc">Table of Contents</h2>


<!--begin-toc-->
<ol class="toc">
 <li><a href="#introduction"><span class="secno">1 </span>Introduction</a></li>
 <li><a href="#conformance"><span class="secno">2 </span>Conformance</a></li>
 <li><a href="#terminology"><span class="secno">3 </span>Terminology</a></li>
 <li><a href="#web-alarms-api"><span class="secno">4 </span>Web Alarms API</a>
  <ol class="toc">
   <li><a href="#interface-navigator"><span class="secno">4.1 </span>Interface <code title="">Navigator</code></a></li>
   <li><a href="#interface-alarmmanager"><span class="secno">4.2 </span>Interface <code title="">AlarmManager</code></a></li>
   <li><a href="#interface-alarm"><span class="secno">4.3 </span>Interface <code title="">Alarm</code></a></li>
   <li><a href="#interface-alarmrequest"><span class="secno">4.4 </span>Interface <code title="">AlarmRequest</code></a></li>
   <li><a href="#interface-alarmevent"><span class="secno">4.5 </span>Interface <code title="">AlarmEvent</code></a></ol></li>
 <li><a class="no-num" href="#references">References</a></li>
 <li><a class="no-num" href="#acknowledgments">Acknowledgements</a></ol>
<!--end-toc-->

<h2 id="introduction"><span class="secno">1 </span>Introduction</h2>

<p><em>This section is non-normative.</em></p>

<div class="example">
<p>Example use of the Alarm API for adding, getting and removing and listening to alarms in the device:

<p>How to add an <code>"ignoreTimezone"</code> alarm? 
<pre> var alarmId1;
 var request = navigator.alarms.add(new Date("May 15, 2012 16:20:00"), "ignoreTimezone", { mydata: "bar" });
 request.onsuccess = function (e) { alarmId1 = e.target.result; };
 request.onerror = function (e) { alert(e.target.error.name); };
</pre>

<p>How to add an <code>"honorTimezone"</code> alarm? 
<pre> var alarmId2;
 var request = navigator.alarms.add(new Date("June 29, 2012 07:30:00"), "honorTimezone", { mydata: "foo" });
 request.onsuccess = function (e) { alarmId2 = e.target.result; };
 request.onerror = function (e) { alert(e.target.error.name); };
</pre>

<p>How to retrieve the information of added alarms? 
<pre> var request = navigator.alarms.getAll();
 request.onsuccess = function (e) { alert(JSON.stringify(e.target.result)); };
 request.onerror = function (e) { alert(e.target.error.name); };
</pre>

<p>How to remove an added alarm? 
<pre> var request = navigator.alarms.remove(alarmId1);
 request.onsuccess = function (e) { alert("alarm removed"); };
 request.onerror = function (e) { alert(e.target.error.name); };
</pre>

<p>How to listen to the <code><a href="#alarm">"alarm"</a></code> event with a callback function which will run whem an alarm goes off? 
<pre> navigator.alarms.addEventListener("alarm", function (message) { alert("alarm fired: " + JSON.stringify(message)); }, false);
</pre>
</div>

<h2 id="conformance"><span class="secno">2 </span>Conformance</h2>

<p>This specification defines conformance criteria that apply to a single product: the <dfn id="ua">user agent</dfn> that implements
the interfaces that it contains.

<p>Implementations that use ECMAScript to implement the APIs defined in this specification MUST implement them
in a manner consistent with the ECMAScript Bindings defined in the Web IDL specification <a href="#refsWEBIDL">[WEBIDL]</a>, as this specification
uses that specification and terminology.

<h2 id="terminology"><span class="secno">3 </span>Terminology</h2>

<p>The <code><a href="http://dev.w3.org/html5/spec/webappapis.html#eventhandler"> EventHandler</a></code>
interface represents a callback used for event handlers as defined in <a href="#refsHTML5">[HTML5]</a>.

<p>The concepts <dfn id="queue-a-task"><a href="http://dev.w3.org/html5/spec/webappapis.html#queue-a-task">
queue a task</a></dfn> and <dfn id="fire-a-simple-event"><a href="http://dev.w3.org/html5/spec/webappapis.html#fire-a-simple-event">
fire a simple event</a></dfn> are defined in <a href="#refsHTML5">[HTML5]</a>.

<p>The terms <dfn id="event-handler"><a href="http://dev.w3.org/html5/spec/webappapis.html#event-handlers"> event handler</a></dfn>
and <dfn id="event-handler-event-types"><a href="http://dev.w3.org/html5/spec/webappapis.html#event-handler-event-type"> event handler event types</a></dfn>
are defined in <a href="#refsHTML5">[HTML5]</a>.

<h2 id="web-alarms-api"><span class="secno">4 </span>Web Alarms API</h2>

<h3 id="interface-navigator"><span class="secno">4.1 </span>Interface <code title="">Navigator</code></h3>
<pre class="idl">partial interface Navigator {
  readonly attribute <a href="#alarmmanager">AlarmManager</a> <a href="#navigator-alarms" title="Navigator-alarms">alarms</a>;
}</pre>

<p>The <dfn id="navigator-alarms" title="Navigator-alarms"><code>alarms</code></dfn> attribute must return the object through which the alarms functionality can be accessed.

<h3 id="interface-alarmmanager"><span class="secno">4.2 </span>Interface <code title="">AlarmManager</code></h3>

The <a href="#alarmmanager"><code>AlarmManager</code></a> interface exposes methods to get, set or remove alarms. Alarms are application specific, so there is no way to see the alarms scheduled by other applications nor to modify them.

<pre class="idl">enum <dfn id="timezonedirective">TimezoneDirective</dfn> { "honorTimezone", "ignoreTimezone" };

[NoInterfaceObject]
interface <dfn id="alarmmanager">AlarmManager</dfn> : <a class="external" href="http://dom.spec.whatwg.org/#eventtarget">EventTarget</a> {
  <a href="#alarmrequest">AlarmRequest</a> <a href="#alarmmanager-getall" title="AlarmManager-getAll">getAll</a>();
  <a href="#alarmrequest">AlarmRequest</a> <a href="#alarmmanager-add" title="AlarmManager-add">add</a>(Date <var title="">date</var>, <a href="#timezonedirective">TimezoneDirective</a> <var title="">respectTimezone</var>, optional Object <var title="">data</var>);
  <a href="#alarmrequest">AlarmRequest</a> <a href="#alarmmanager-remove" title="AlarmManager-remove">remove</a>(DOMString <var title="">alarmId</var>);
};</pre>

<p>The <dfn id="alarmmanager-getall" title="AlarmManager-getAll"><code>getAll()</code></dfn> method is used to to retrieve all the alarms added to the device as an array of <a href="#alarm">Alarm</a> objects.
<p>The <dfn id="alarmmanager-add" title="AlarmManager-add"><code>add(<var>alarm</var>, <var>respectTimezone</var>[, <var>data</var>])</code></dfn> method is used to register a an alarm.
<ol>
<li>The first argument <code>date</code> can be passed by a <code>Date</code> object.</li>
<li>The second argument <code>respectTimezone</code> can be passed by either <code>"honorTimezone"</code> or <code>"ignoreTimezone"</code> to specify if we need to ignore the timezone information of that <code>Date</code> object. When <code>"honorTimezone"</code> is passed, we will alert that application when that time happens in that timezone. I.e. if someone passes a <code>Date</code> object which has the timezone set to US Pacific Time and time set to 7am, we will alert the application when the time is 7am in the US Pacific timezone, even if the user is in New York and thus in US Eastern Time and it's 10am for the user. When <code>"ignoreTimezone"</code> is passed, we will ignore the timezone part of the passed in <code>Date</code> object. I.e. if someone passes a Date object which has the timezone set to US Pacific Time and time set to 7am, we will alert the application when the time is 7am in whatever timezone the user happens to be in. So if the user is in New York, we will alert the user when it's 7am in that timezone.</li>
<li>The third argument <code>data</code> can be optionally specified to pass the customized JSON object data for that alarm. Note that an unique ID will be returned to refer to the added alarm.</li>
</ol>
<p>The <dfn id="alarmmanager-remove" title="AlarmManager-remove"><code>remove(<var>alarmId</var>)</code></dfn> method is used to remove an alarm that has been added in the device with a unique ID.

<h3 id="interface-alarm"><span class="secno">4.3 </span>Interface <code title="">Alarm</code></h3>
<p>The <a href="#alarm"><code>Alarm</code></a> interface captures the properties of a registered alarm.

<pre class="idl">interface <dfn id="alarm">Alarm</dfn> {
  readonly attribute DOMString <a href="#alarm-id" title="Alarm-id">id</a>;

  attribute Date <a href="#alarm-date" title="Alarm-date">date</a>;
  attribute <a href="#timezonedirective">TimezoneDirective</a> <a href="#alarm-respecttimezone" title="Alarm-respectTimezone">respectTimezone</a>;
  attribute Object <a href="#alarm-data" title="Alarm-data">data</a>;
};</pre>

<p>The <dfn id="alarm-id" title="Alarm-id"><code>id</code></dfn> attribute must return an identifier for the given <a href="#alarm"><code>Alarm</code></a> object that is unique within the origin. An implementation must maintain this identifier when a <a href="#alarm"><code>Alarm</code></a> is added.

<p>The <dfn id="alarm-date" title="Alarm-date"><code>date</code></dfn> attribute is a <code>Date</code> object indicating when the alarm goes off.

<p>The <dfn id="alarm-respecttimezone" title="Alarm-respectTimezone"><code>respectTimezone</code></dfn> attribute indicates if the timezone information of the <code>Date</code> object is ignored.

<p>The <dfn id="alarm-data" title="Alarm-data"><code>data</code></dfn> attribute optionally defines the customized JSON object data pass to the alarm.

<h3 id="interface-alarmrequest"><span class="secno">4.4 </span>Interface <code title="">AlarmRequest</code></h3>
<pre class="idl">interface <dfn id="alarmrequest">AlarmRequest</dfn> : <a class="external" href="http://dom.spec.whatwg.org/#eventtarget">EventTarget</a>
  readonly attribute DOMString <a href="#alarmrequest-readystate" title="AlarmRequest-readyState">readyState</a>;

  readonly attribute any <a href="#alarmrequest-result" title="AlarmRequest-result">result</a>;
  readonly attribute <a class="external" href="http://dom.spec.whatwg.org/#domerror">DOMError</a> <a href="#alarmrequest-error" title="AlarmRequest-error">error</a>;

  [TreatNonCallableAsNull]
  attribute Function? <a href="#alarmrequest-onsuccess" title="AlarmRequest-onsuccess">onsuccess</a>;

  [TreatNonCallableAsNull]
  attribute Function? <a href="#alarmrequest-onerror" title="AlarmRequest-onerror">onerror</a>;
};
</pre>

<p>The <dfn id="alarmrequest-readystate" title="AlarmRequest-readyState"><code>readyState</code></dfn> attribute must return the state of this <a href="#alarmrequest"><code>AlarmRequest</code></a>. Possible values are <code>"pending"</code> and <code>"done"</code>.

<p>The <dfn id="alarmrequest-result" title="AlarmRequest-result"><code>result</code></dfn> attribute must return the result of this <a href="#alarmrequest"><code>AlarmRequest</code></a> (if any), once the <a href="#alarmrequest-readystate" title="AlarmRequest-readyState"><code>readyState</code></a> is <code>"done"</code> and the <code>success</code> event is fired.

<p>The <dfn id="alarmrequest-error" title="AlarmRequest-error"><code>error</code></dfn> attribute must return the error that occurred for this <a href="#alarmrequest"><code>AlarmRequest</code></a> (if any). This attribute is populated when the <code>error</code> event is fired.

<p>The <dfn id="alarmrequest-onsuccess" title="AlarmRequest-onsuccess"><code>onsuccess</code></dfn> is the callback function called when this <a href="#alarmrequest"><code>AlarmRequest</code></a> completes successfuly.

<p>The <dfn id="alarmrequest-onerror" title="AlarmRequest-onerror"><code>onerror</code></dfn> is the callback function called when an error occurred during the execution of this <a href="#alarmrequest"><code>AlarmRequest</code></a>.

<h3 id="interface-alarmevent"><span class="secno">4.5 </span>Interface <code title="">AlarmEvent</code></h3>
<p>The <code title="">alarm</code> event is fired when an alarm goes off.

<p>When this happens, the user agent must queue a task to fire an event with the name <code title="">alarm</code>, which does not bubble and is not cancelable, and which uses the <a href="#alarmevent"><code>AlarmEvent</code></a> interface, at each <a href="#alarmmanager"><code>AlarmManager</code></a> object that is affected.

<pre class="idl">[Constructor(DOMString <var title="">type</var>, optional <a href="#alarmeventinit">AlarmEventInit</a> <var title="">eventInitDict</var>)]
interface <dfn id="alarmevent">AlarmEvent</dfn> : <a class="external" href="http://dom.spec.whatwg.org/#event">Event</a> {
  readonly attribute <a href="#alarm">Alarm</a> <span title="AlarmEvent-alarm">alarm</span>;
};

dictionary <dfn id="alarmeventinit">AlarmEventInit</dfn> : <a class="external" href="http://dom.spec.whatwg.org/#eventinit">EventInit</a> {
  <a href="#alarm">Alarm</a> alarm;
};</pre>

<p>The <dfn id="alarmevent-added" title="AlarmEvent-added"><code>alarm</code></dfn> attribute must return the alarm that is going off.

<h2 class="no-num" id="references">References</h2>
<div id="anolis-references"><dl><dt id="refsHTML5">[HTML5]
<dd><cite><a href="http://dev.w3.org/html5/spec/">HTML5</a></cite>, Ian Hickson. W3C.

<dt id="refsWEBIDL">[WEBIDL]
<dd><cite><a href="http://dev.w3.org/2006/webapi/WebIDL/">Web IDL</a></cite>, Cameron McCormack. W3C.

</dl></div>

<h2 class="no-num" id="acknowledgments">Acknowledgements</h2>

<p> TODO

